\documentclass{article}
\usepackage[letterpaper, total={6.5in, 9in}]{geometry}
\usepackage{graphicx} % Required for inserting images
\usepackage{hyperref}
\usepackage[simplified]{pgf-umlcd}
\usepackage{pdflscape}
\usepackage{xcolor}

\renewcommand {\umltextcolor}{black}
\renewcommand {\umlfillcolor}{white}
\renewcommand {\umldrawcolor}{black}

% \usepackage{emoji}  % LuaLaTeX
% \setemojifont{TwemojiMozilla}

\title{Processing Relay Chat -- PRC}
\author{David Chen -- Team PLA (Pretty Lazy Acronym)}
\date{Period 6}

\begin{document}

\maketitle

\section{Description}
Processing Relay Chat (PRC) encompasses a client program, server program, and protocol for instant messaging over the network. To accomplish this in Processing PRC the \href{https://processing.org/reference/libraries/net/index.html}{Network} library.\\
PRC will include the following minimum features:
\begin{itemize}
    \item Ephemeral plaintext (UTF-8) messaging
    \item IRC-like channels with descriptions
    \item Usernames with deterministic colors
    \item Message timestamps
    \item Light and Dark modes for interface display
\end{itemize}

Optionally, PRC extensions may include (to be implemented after core functionality is complete):
\begin{itemize}
    \item A slash command framework for advanced user interaction
    \item Image embedding, including animated GIFs
    \item Clickable links
    \item File sharing functionality
    \item Chat log export
    \item Simple games embedded in the chat window (Tic-Tac-Toe, Checkers, etc.)
    \item Additional themes for the interface (\href{https://draculatheme.com/}{Dracula}, \href{https://catppuccin.com/}{Catppuccin}, \href{https://www.nordtheme.com/}{Nord}, etc.)
    \item IRC bridging/client-mode compatibility (highly ambitious)
\end{itemize}

\begin{landscape}
\section{UML Diagram}

\begin{tikzpicture}
\begin{scope}[scale=0.8, transform shape]
    \begin{abstractclass}[text width = 4cm]{Text}{20,4}
	\attribute{+regular: PFont}
	\attribute{+bold: PFont}
	\attribute{+italic: PFont}
	\attribute{+fontSize: int}
	\attribute{+fontWidth: float}
	\attribute{+lineSpace: float}
        \operation{+display(int x, int y, int w): int[3]}
        \operation{+display(int x, int y, int w, String s): int[3]}
        \operation{+display(int x, int y, int w, String s, color c): int[3]}
        \operation{+display(int x, int y, int w, String s, color c, PFont font): int[3]}
    \end{abstractclass}
	\umlnote[draw] at (20, 8) (text) {Due to Processing limitations, instance variables (which are static, and initialized in \verb|setup()|) are in a static superclass \verb|TextConstants|.};

    \begin{class}[text width = 4cm]{Display}{12,-8}
        \attribute{-width: int}
        \attribute{-height: int}
        \operation{+reposition(int x, int y): void}
        \operation{+resize(int w, int h): void}
        \operation{+display(): float[2]}
        \operation{+addLine(Text t): void}
    \end{class}
    \unidirectionalAssociation{Display}{lines}{0..*}{Text}

    \begin{class}[text width = 4cm]{User}{12, 8}
        \implement{Text}
        \attribute{-username: String}
        \attribute{-hostname: String}
        \attribute{-userColor: color}
        \operation{+getUsername(): String}
        \operation{+getHostname(): String}
        \operation{+setUsername(String newUsername): boolean}
        \operation{-regenerate(): void}
    \end{class}

    \begin{class}[text width = 4cm]{Channel}{12,0}
        \implement{Text}
        \attribute{-name: String}
        \attribute{-topic: String}
	\operation{+displayVerbose(int x, int y, int w): int[3]}
        \operation{+getName(): String}
        \operation{+getTopic(): String}
        \operation{+setTopic(String newTopic): boolean}
    \end{class}
    \unidirectionalAssociation{Channel}{users}{0..*}{User}

    \begin{class}[text width = 4cm]{Message}{20,-8}
        \implement{Text}
        \attribute{-content: String}
    \end{class}
    \association{Channel}{channel}{1}{Message}{0..*}{messages}
    \unidirectionalAssociation{Message}{author}{1}{User}

    \begin{abstractclass}{Command}{-4,0}
        \attribute{-helpInfo: String}
        \operation{+getHelp(): String}
        \operation{+execute(String[] args): void}
    \end{abstractclass}

    \begin{class}[text width = 4cm]{Server}{4,2}
        \attribute{-port: int}
    \end{class}
    \unidirectionalAssociation{Server}{screens}{0..1}{Display}
    \unidirectionalAssociation{Server}{channels}{0..*}{Channel}
    \unidirectionalAssociation{Server}{commands}{2..*}{Command}

    \begin{class}{Client}{4, -4}
        \operation{+connect(Server s): boolean}
    \end{class}
    \unidirectionalAssociation{Client}{user}{1}{User}
    \unidirectionalAssociation{Client}{commands}{2..*}{Command}
    \unidirectionalAssociation{Client}{screens}{0..*}{Display}
    \unidirectionalAssociation{Client}{channels}{0..*}{Channel}

    \association{Server}{server}{1}{Client}{clients}{0..*}

    \umlnote[draw] at (-4, -4) (commands-note) {Both client and server have, at minimum, \verb|/help| and \verb|/quit|.};
\end{scope}
\end{tikzpicture}
\end{landscape}

\section{Manual}
The main Processing program will serve as a launcher, allowing the user to select from server or client modes (or, perhaps, both simultaneously, analogous to LAN multiplayer in video games).

\subsection{Server Mode}
The user will be able to select a TCP port for the server to broadcast on.

The program will then display a log of server interactions (user connections, messages, disconnections). The user can quit the program using \verb|/quit|.

\subsection{Client Mode}
The user will then enter a server address/port to connect to. On successful connection, the user can register a username, which the server will check for uniqueness. If the username is rejected, the user is prompted to enter another username.

The client will then be offered a list of channel names (and their corresponding topics). The client can choose to connect to a channel, upon which they will be put into a chat window view.


\subsubsection{Chat Window}
The main chat window will display messages, usernames, and timestamps. Below the chat window, an input will be available for user messages/commands.

\paragraph{Slash Commands}
To join a room, use \verb|/join|. To leave a room, use \verb|/leave.| To quit the client, use \verb|/quit| (aliased to \verb|/q|).

For information on further commands, use \verb|/help|.

\section{Functionality}
The goal for the coming week is to begin the initial framework for PRC; implementing all minimum features described in the specification.

\subsection{Issues}
\begin{enumerate}
    \item To share font data among \verb|Text| subclasses, it was appropriate to use \verb|static| variables, but there may be "non-\verb|static| inner type" issues when trying to declare \verb|static| variables in the \verb|Text| abstract class. To fix this, the abstract class itself must be declared \verb|static|. (\href{https://forum.processing.org/two/discussion/23623/when-creating-a-class-what-is-it-an-inner-class-of-declared-static-in-a-non-static-inner-type.html}{Source})
\end{enumerate}

\section{Log}
\begin{itemize}
    \item 05/20: Began writing program specifications in \LaTeX.
    \item 05/21 -- 05/22: Constructed UML class diagrams for anticipated object classes.
    \item 05/23 -- 05/24: Corrected text location alignment issues.
    \item 05/25: Implemented Text subclasses and display() functions; turned Text into an abstract base class to deduplicate logic; Implemented Display and constructed a testing mockup.
\end{itemize}

\end{document}
